From 413e93e10ee4838e9a68b190f1468722f6385e0e Mon Sep 17 00:00:00 2001
From: Nitin Garg <nitin.garg@nxp.com>
Date: Wed, 17 Jul 2019 09:29:32 +0800
Subject: [PATCH 2/2] Fix A72 L2 DATA latency settings.

Signed-off-by: Anson Huang <Anson.Huang@nxp.com>
(cherry picked from commit 91e7cb2b7be53a20b16ade22f954f3001574ffc8)
---
 plat/imx/common/imx8_helpers.S | 29 +++++++++++++++++++++++++++++
 1 file changed, 29 insertions(+)

diff --git a/plat/imx/common/imx8_helpers.S b/plat/imx/common/imx8_helpers.S
index e88c3a20..f74cbe48 100644
--- a/plat/imx/common/imx8_helpers.S
+++ b/plat/imx/common/imx8_helpers.S
@@ -7,6 +7,7 @@
 #include <asm_macros.S>
 #include <platform_def.h>
 #include <cortex_a35.h>
+#include <cortex_a72.h>
 
 	.globl	plat_is_my_cpu_primary
 	.globl	plat_my_core_pos
@@ -85,6 +86,34 @@ func plat_calc_core_pos
 	ret
 endfunc plat_calc_core_pos
 
+	/* ----------------------------------------------
+	 * function to handle platform specific reset.
+	 * ----------------------------------------------
+	 */
+func plat_reset_handler
+	/* enable EL2 cpuectlr RW access */
+	mov	x0, #0x73
+	msr	actlr_el3, x0
+	msr	actlr_el2, x0
+	isb
+	/* --------------------------------------------------------------------
+	 * Nothing to do on Cortex-A53.
+	 * --------------------------------------------------------------------
+	 */
+	jump_if_cpu_midr CORTEX_A72_MIDR, A72
+	ret
+
+A72:
+	/* --------------------------------------------------------------------
+	 * Cortex-A72 specific settings
+	 * --------------------------------------------------------------------
+	 */
+	mov	x0, #(CORTEX_A72_L2_DATA_RAM_LATENCY_3_CYCLES << CORTEX_A72_L2CTLR_DATA_RAM_LATENCY_SHIFT)
+	msr	CORTEX_A72_L2CTLR_EL1, x0
+	isb
+	ret
+endfunc plat_reset_handler
+
 	/* ---------------------------------------------
 	 * function to get the entrypoint.
 	 * ---------------------------------------------
-- 
2.17.1

